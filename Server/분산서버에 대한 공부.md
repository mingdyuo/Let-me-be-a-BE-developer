### 분산처리 서버에서 생기는 이슈

[분산처리 - 서버 제작의 여러 방식](https://12bme.tistory.com/278)

- 네트워크 이슈

  서버를 제작할 때 가장 크게 오버헤드 걸리는 것은 `Accept`와 `Disconnect`이다. 

  현재 `Accept` 핸들링은 `AcceptEx`가 최선의 선택이라는 것이 학계의 정설이라고 한다. 

  하지만 `AcceptEx`를 어떻게 사용하는지에 대해서는 의견이 갈린다. (Pooling 하거나, 하지 않거나)

- 메모리 관리 이슈

  1. `malloc`/`free` 혹은 `new`/`delete`를 할 때의 성능

     `new`보다 `delete` 호출 시 더 많은 시간이 소요된다고 알려져 있다.

  2. `Static Allocation`

     이건 `C`에서 많이 사용된 방식인데 `C++`로 넘어오며 객체 지향 언어에는 어울리지 않지만 성능을 위해서 구조를 버리면서 사용하고 있다. 속도 면에서 많은 이득이 있다.

  3. Memory Pooling

     구조는 정적 할당이나 사용 방식은 동적 할당처럼 사용함

- 데이터베이스에 대한 이슈

  데이터베이스 설계 및 쿼리에 대한 이슈보다는 데이터베이트 프로토콜 이슈와 벤치마크에 대한 내용

<br>

### 네이버 메인 페이지 분산 처리

[D2 포스트](https://d2.naver.com/helloworld/6070967)

<img src="https://d2.naver.com/content/images/2018/11/helloworld-201810-naver_main-03.png" alt="그림 3 웹 서비스의 일반적인 3계층 분산 처리 모델" style="zoom:67%;" />

- 데이터베이스 다중화 시 생기는 문제

  1. 데이터 스토리지 레이어의 다중화는 어렵다. 데이터 동기화가 필요하기 때문

  2. 사용하는 데이터베이스가 RDB라면

     다중화를 어떻게 할 것인지, 데이터를 어떻게 분산할 것인지 고려해야 한다.

     샤딩 등을 도입했을 때 데이터가 늘어나 샤드를 추가해야 한다면, 기존 데이터의 마이그레이션은 어떻게 할지 고민해야 한다.

  3. 사용하는 데이터베이스가 NoSQL라면

     데이터 정합성, 동기화, 장애 복구 시 다수결에 의한 <u>데이터 오염 가능성(이게 모지?)</u> 등을 고려해야 한다.

- 서비스 특성에 따른 요구 사항

  1. 대부분의 역할은 데이터를 사용자에 보여주는 역할(View)

     데이터를 받거나 저장하는 동작이 거의 없으므로, 트랜잭션을 적게 고려해도 된다.

  2. 어떤 서버로 접속해도 동일한 내용을 보여주어야 한다. 특정 상태값 (로그인 세션) 등에 의존하면 안된다.

  3. 무슨 일이 있어도 사용자에게 서비스가 제공되어야 한다.

     - 브라우저에 빈 페이지 X
     - 연동된 외부 시스템은 언제든 접속이 불안해질 가능성을 감안하여 빠른 실패 전략을 실행할 수 있어야 한다.

  4. 트래픽 증가에 탄력적으로 대처해야 한다.

     - 트래픽 폭주 시 서버 증설만으로 대응할 수 있어야 한다.
     - 각 컴포넌트 (웹 서버, WAS)의 효율성을 극대화 할 수 있어야 한다.

- 분산 처리 기술

  1. GCDN (Global CDN)

     - 공통적으로 호출되는 리소스(CSS, JS, 이미지 등)의 부하 분산을 위해 사용
     - GSLB(Global Server LB)기능은 접속한 IP 주소에서 가장 가까운 CDN 서버를 자동으로 선정해 연결하므로 빠른 서비스 속도 가능

  2. SSI (Server Side Includes)

     - Apache, nginx 등의 웹 서버에서 지원하는 서버사이드 스크립트 언어

  3. Apache 커스텀 모듈

  4. 마이크로서비스 (부분 도입)

     1. 서킷 브레이커

        [서킷 브레이커 라이브러리](https://github.com/Netflix/hystrix)

     2. 서비스 디스커버리

